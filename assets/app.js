const I18N_LABELS={es:{brand:"√Ångel Ortiz",nav:{home:"Inicio",summary:"Resumen",phases:"Fases",career:"Carrera",achievements:"Logros",skills:"Habilidades",awards:"Reconocimientos",charts:"Gr√°ficos",contact:"Contacto"},sections:{summary:"Resumen Ejecutivo",phases:"Fases de Carrera",career:"Trayectoria",achievements:"Logros",skills:"Habilidades",awards:"Reconocimientos & Premios",charts:"Gr√°ficos",contact:"Contacto"},charts:{yearsByPhase:"A√±os por Fase",skillsRadar:"Matriz de Competencias"},cta:{downloadCv:"Descargar CV (PDF)"},contact:{emailLabel:"Correo:"}},en:{brand:"√Ångel Ortiz",nav:{home:"Home",summary:"Summary",phases:"Phases",career:"Career",achievements:"Achievements",skills:"Skills",awards:"Awards",charts:"Charts",contact:"Contact"},sections:{summary:"Executive Summary",phases:"Career Phases",career:"Career Timeline",achievements:"Key Achievements",skills:"Skills",awards:"Recognitions & Awards",charts:"Charts",contact:"Contact"},charts:{yearsByPhase:"Years by Phase",skillsRadar:"Skills Matrix"},cta:{downloadCv:"Download CV (PDF)"},contact:{emailLabel:"Email:"}};
function setStaticLabels(lang){const d=I18N_LABELS[lang]||I18N_LABELS.en;document.querySelectorAll('[data-i18n]').forEach(el=>{const path=el.getAttribute('data-i18n').split('.');let obj=d;for(const p of path){obj=obj?.[p]} if(typeof obj==='string') el.textContent=obj;});const lbl=document.getElementById('langLabel'); if(lbl) lbl.textContent=lang.toUpperCase();}
async function loadConfig(lang){const file=lang==='es'?'data/config.es.json':'data/config.en.json';const r=await fetch(file);return await r.json();}
function initHamburger(){const t=document.querySelector('.nav-toggle'),m=document.querySelector('.nav-menu');if(!t||!m)return;t.addEventListener('click',()=>{const o=t.classList.toggle('is-open');m.classList.toggle('is-open',o);t.setAttribute('aria-expanded',o?'true':'false')});m.querySelectorAll('a').forEach(a=>a.addEventListener('click',()=>{t.classList.remove('is-open');m.classList.remove('is-open');t.setAttribute('aria-expanded','false')}));}
function initLangSelector(apply){const w=document.querySelector('.lang-switch'),b=document.getElementById('langBtn'),menu=document.getElementById('langMenu');if(!w||!b||!menu)return;b.addEventListener('click',e=>{e.stopPropagation();w.classList.toggle('open')});menu.querySelectorAll('[data-lang]').forEach(a=>a.addEventListener('click',e=>{e.preventDefault();const lang=a.getAttribute('data-lang');localStorage.setItem('site_lang',lang);w.classList.remove('open');apply(lang);}));document.addEventListener('click',()=>w.classList.remove('open'));}
function fillHeader(cfg){const t=(id,v)=>{const e=document.getElementById(id); if(e) e.textContent=v;};t('name',cfg.personal.name);t('title',cfg.personal.title);t('subtitle',cfg.personal.subtitle);const e1=document.getElementById('emailLink'),e2=document.getElementById('emailLink2');if(e1){e1.textContent=cfg.personal.email;e1.href='mailto:'+cfg.personal.email} if(e2){e2.textContent=cfg.personal.email;e2.href='mailto:'+cfg.personal.email} const lin=document.getElementById('linkedinLink'); if(lin) lin.href=cfg.personal.linkedin;t('location',cfg.personal.location);t('location2',cfg.personal.location);const cv=document.getElementById('downloadCV'); if(cv&&cfg.personal.cv_pdf){cv.href=cfg.personal.cv_pdf} const stats=document.getElementById('heroStats'); if(stats){stats.innerHTML='';(cfg.stats||[]).forEach(s=>{const d=document.createElement('div');d.className='stat';d.innerHTML=`<span class="num">${s.value}</span><span class="lbl">${s.label}</span>`;stats.appendChild(d);});}}
function renderSummary(cfg){const box=document.getElementById('summary'); if(!box) return; box.innerHTML=''; (cfg.summary||[]).forEach(p=>{const el=document.createElement('p'); el.textContent=p; box.appendChild(el);});}
function renderPhases(cfg){const box=document.getElementById('phases'); if(!box) return; box.innerHTML=''; (cfg.phases||[]).forEach(ph=>{const card=document.createElement('div'); card.className='phase-card'; card.innerHTML=`<h4>${ph.title}</h4><div class="duration">${ph.duration}</div><p>${ph.text}</p>`; box.appendChild(card);});}
function renderLineTimeline(cfg){const box=document.getElementById('lineTimeline'); if(!box) return; box.innerHTML=''; (cfg.timeline||[]).forEach(t=>{const it=document.createElement('div'); it.className='lt-item'; it.style.setProperty('--dot', t.color||'#1e3a8a'); it.innerHTML=`<div class="lt-head"><span class="lt-period">${t.period}</span> <span class="lt-role">${t.role}</span> ¬∑ <span class="lt-company">${t.company}</span></div><div class="lt-desc">${t.desc}</div>`; box.appendChild(it);});}
function renderAchievements(cfg){const box=document.getElementById('achievements'); if(!box) return; box.innerHTML=''; (cfg.achievements||[]).forEach(a=>{const d=document.createElement('div'); d.className='card'; d.innerHTML=`<div class="kpi">${a.metric}</div><div>${a.text}</div>`; box.appendChild(d);});}
function getYouTubeId(url){const m=url?.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([A-Za-z0-9_-]{6,})/);return m?m[1]:null;}
function renderAwards(cfg){const box=document.getElementById('awards'); if(!box) return; box.innerHTML=''; (cfg.awards||[]).forEach(a=>{const wrap=document.createElement('div'); wrap.className='award'; const titleHtml=a.title?`<h4 class="award-title">${(a.link||a.video)?`<a href="${(a.link||a.video)}" target="_blank" rel="noopener">${a.title}</a>`:a.title}</h4>`:''; let mediaHtml=''; if(a.image){ const src=a.image.startsWith('http')?a.image:`img/${a.image}`; mediaHtml=`<img class="media" src="${src}" alt="${a.title||'award'}" loading="lazy">`; } else if(a.video){ const id=getYouTubeId(a.video); if(id){ const thumb=`https://img.youtube.com/vi/${id}/hqdefault.jpg`; mediaHtml=`<img class="media" src="${thumb}" alt="${a.title||'video'}" loading="lazy">`; } } if(mediaHtml && (a.video||a.link)){ mediaHtml=`<a class="media-link" href="${(a.video||a.link)}" target="_blank" rel="noopener">${mediaHtml}</a>`; } wrap.innerHTML=`<div class="head"><div class="icon">${a.icon||'üèÜ'}</div>${titleHtml}</div><div class="text">${a.text||''}</div>${mediaHtml?`<div class="media-box">${mediaHtml}</div>`:''}`; box.appendChild(wrap); });}
function renderSkills(cfg){const box=document.getElementById('skills'); if(!box) return; box.innerHTML=''; (cfg.skills||[]).forEach(s=>{const el=document.createElement('div'); el.className='skill'; el.innerHTML=`<div class="skill-header"><span>${s.name}</span><span class="level">${s.level}%</span></div><div class="bar"><span style="--w:${s.level}%"></span></div>`; box.appendChild(el);}); const obs=new IntersectionObserver(es=>{es.forEach(e=>{if(e.isIntersecting){e.target.querySelectorAll('.bar span').forEach(sp=>{sp.style.width=getComputedStyle(sp).getPropertyValue('--w')})}})},{threshold:0.3}); obs.observe(box);}
function renderCharts(cfg){if(!window.Chart) return; const c1=document.getElementById('careerChart'); if(c1){new Chart(c1,{type:'bar',data:{labels:cfg.career_years.labels,datasets:[{label:'Years',data:cfg.career_years.values,backgroundColor:['#1e3a8a','#3b82f6','#60a5fa']}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{y:{beginAtZero:true,ticks:{stepSize:2}}}}})} const c2=document.getElementById('skillsRadar'); if(c2){new Chart(c2,{type:'radar',data:{labels:cfg.radar.labels,datasets:[{label:'Level',data:cfg.radar.values,borderColor:'#1e3a8a',backgroundColor:'rgba(30,58,138,0.2)',pointBackgroundColor:'#1e3a8a'}]},options:{responsive:true,maintainAspectRatio:false,scales:{r:{suggestedMin:0,suggestedMax:10,ticks:{stepSize:2}}}}})}}
async function applyLanguage(lang){setStaticLabels(lang); const cfg=await loadConfig(lang); fillHeader(cfg); renderSummary(cfg); renderPhases(cfg); renderLineTimeline(cfg); renderAchievements(cfg); renderSkills(cfg); renderAwards(cfg); renderCharts(cfg)}
document.addEventListener('DOMContentLoaded', async ()=>{initHamburger(); let lang=localStorage.getItem('site_lang'); if(!lang){const nav=(navigator.language||navigator.userLanguage||'en').toLowerCase(); lang=nav.startsWith('es')?'es':'en'} await applyLanguage(lang); initLangSelector(async l=>{await applyLanguage(l)});});